# |
# o---------------------------------------------------------------------o
# |
# | MAD makefile - post-makefile MacOSX customization
# |
# o---------------------------------------------------------------------o
# |
# | Methodical Accelerator Design
# |
# | Copyright (c) 2011+ CERN, mad@cern.ch
# |
# | For more information, see http://cern.ch/mad
# |
# o---------------------------------------------------------------------o
# |
# | $Id$
# |

# use macport GCC suite
ifeq ($(USER),ldeniau)
%-gnu: GNUMAC := CC=gcc-mp-4.7 CXX=g++-mp-4.7 FC=gfortran-mp-4.7 LD=gfortran-mp-4.7 \
                 CCNAME=gcc CXXNAME=g++ FCNAME=gfortran LDNAME=gfortran
else
%-gnu: GNUMAC := GNU=yes
endif

#
# madx
#
.PHONY:                 madx-dev-macosx           madx-dev-macosx-gnu
.PHONY:                 madx-dev-macosx32         madx-dev-macosx64
.PHONY:                 madx-dev-macosx32-gnu     madx-dev-macosx64-gnu
madx-dev-macosx:        madx-dev-macosx32         madx-dev-macosx64
madx-dev-macosx-gnu:    madx-dev-macosx32-gnu     madx-dev-macosx64-gnu

madx-dev-macosx32:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=32 ONLINE=no STATIC=no Intel=yes APPENDLD=yes && \
     $(CP) madx32 $@

madx-dev-macosx64:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=64 ONLINE=no STATIC=no Intel=yes APPENDLD=yes && \
     $(CP) madx64 $@

madx-dev-macosx32-gnu:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=32 ONLINE=no STATIC=no $(GNUMAC) APPENDLD=yes && \
     $(CP) madx32 $@

madx-dev-macosx64-gnu:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=64 ONLINE=no STATIC=no $(GNUMAC) APPENDLD=yes && \
     $(CP) madx64 $@

#
# libmadx
#
.PHONY:                 libmadx-dev-macosx        libmadx-dev-macosx-gnu
.PHONY:                 libmadx-dev-macosx32      libmadx-dev-macosx64
.PHONY:                 libmadx-dev-macosx32-gnu  libmadx-dev-macosx64-gnu
libmadx-dev-macosx:     libmadx-dev-macosx32      libmadx-dev-macosx64
libmadx-dev-macosx-gnu: libmadx-dev-macosx32-gnu  libmadx-dev-macosx64-gnu

libmadx-dev-macosx32:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/madx --no-print-directory -j5 ARCH=32 ONLINE=no STATIC=no Intel=yes APPENDLD=yes && \
     $(CP) libs/madx/libmadx32.a     $@.a     && ln -sf $@.a     libmadx32.a && \
     $(CP) libs/madx/libmadx32.dylib $@.dylib && ln -sf $@.dylib libmadx32.dylib

libmadx-dev-macosx64:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/madx --no-print-directory -j5 ARCH=64 ONLINE=no STATIC=no Intel=yes APPENDLD=yes && \
     $(CP) libs/madx/libmadx64.a     $@.a     && ln -sf $@.a     libmadx64.a && \
     $(CP) libs/madx/libmadx64.dylib $@.dylib && ln -sf $@.dylib libmadx64.dylib

libmadx-dev-macosx32-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/madx --no-print-directory -j5 ARCH=32 ONLINE=no STATIC=no $(GNUMAC) APPENDLD=yes && \
     $(CP) libs/madx/libmadx32.a     $@.a     && ln -sf $@.a      libmadx32.a && \
     $(CP) libs/madx/libmadx32.dylib $@.dylib && ln -sf $@.dylib libmadx32.dylib

libmadx-dev-macosx64-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/madx --no-print-directory -j5 ARCH=64 ONLINE=no STATIC=no $(GNUMAC) APPENDLD=yes && \
     $(CP) libs/madx/libmadx64.a     $@.a     && ln -sf $@.a     libmadx64.a && \
     $(CP) libs/madx/libmadx64.dylib $@.dylib && ln -sf $@.dylib libmadx64.dylib

#
# libptc
#
.PHONY:                 libptc-dev-macosx        libptc-dev-macosx-gnu
.PHONY:                 libptc-dev-macosx32      libptc-dev-macosx64
.PHONY:                 libptc-dev-macosx32-gnu  libptc-dev-macosx64-gnu
libptc-dev-macosx:      libptc-dev-macosx32      libptc-dev-macosx64
libptc-dev-macosx-gnu:  libptc-dev-macosx32-gnu  libptc-dev-macosx64-gnu

libptc-dev-macosx32:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=32 Intel=yes APPENDLD=yes && \
     $(CP) libs/ptc/libptc32.a     $@.a     && ln -sf $@.a     libptc32.a && \
     $(CP) libs/ptc/libptc32.dylib $@.dylib && ln -sf $@.dylib libptc32.dylib

libptc-dev-macosx64:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=64 Intel=yes APPENDLD=yes && \
     $(CP) libs/ptc/libptc64.a     $@.a     && ln -sf $@.a     libptc64.a && \
     $(CP) libs/ptc/libptc64.dylib $@.dylib && ln -sf $@.dylib libptc64.dylib

libptc-dev-macosx32-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=32 $(GNUMAC) APPENDLD=yes && \
     $(CP) libs/ptc/libptc32.a     $@.a     && ln -sf $@.a     libptc32.a && \
     $(CP) libs/ptc/libptc32.dylib $@.dylib && ln -sf $@.dylib libptc32.dylib

libptc-dev-macosx64-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=64 $(GNUMAC) APPENDLD=yes && \
     $(CP) libs/ptc/libptc64.a     $@.a     && ln -sf $@.a     libptc64.a && \
     $(CP) libs/ptc/libptc64.dylib $@.dylib && ln -sf $@.dylib libptc64.dylib

#
# numdiff
#
.PHONY:                 numdiff-dev-macosx numdiff-dev-macosx-gnu
.PHONY:                 numdiff-dev-macosx32      numdiff-dev-macosx64
.PHONY:                 numdiff-dev-macosx32-gnu  numdiff-dev-macosx64-gnu
numdiff-dev-macosx:     numdiff-dev-macosx32      numdiff-dev-macosx64
numdiff-dev-macosx-gnu: numdiff-dev-macosx32-gnu  numdiff-dev-macosx64-gnu

numdiff-dev-macosx32:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=32 Intel=yes APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff32 $@ && ln -sf $@ numdiff32

numdiff-dev-macosx64:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=64 Intel=yes APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff64 $@ && ln -sf $@ numdiff64

numdiff-dev-macosx32-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=32 $(GNUMAC) APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff32 $@ && ln -sf $@ numdiff32

numdiff-dev-macosx64-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=64 $(GNUMAC) APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff64 $@ && ln -sf $@ numdiff64

# end of makefile
