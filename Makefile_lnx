# |
# o---------------------------------------------------------------------o
# |
# | MAD makefile - post-makefile linux cutomization
# |
# o---------------------------------------------------------------------o
# |
# | Methodical Accelerator Design
# |
# | Copyright (c) 2011+ CERN, mad@cern.ch
# |
# | For more information, see http://cern.ch/mad
# |
# o---------------------------------------------------------------------o
# |
# | $Id$
# |

# madx
.PHONY:                 madx-dev-linux          madx-dev-linux-gnu
.PHONY:                 madx-dev-linux-lahey    madx-dev-linux-nagfor
.PHONY:                 madx-dev-linux32        madx-dev-linux64
.PHONY:                 madx-dev-linux32-gnu    madx-dev-linux64-gnu
.PHONY:                 madx-dev-linux32-lahey  madx-dev-linux64-lahey
.PHONY:                 madx-dev-linux32-nagfor madx-dev-linux64-nagfor
madx-dev-linux:         madx-dev-linux32        madx-dev-linux64
madx-dev-linux-gnu:     madx-dev-linux32-gnu    madx-dev-linux64-gnu
madx-dev-linux-lahey:   madx-dev-linux32-lahey  madx-dev-linux64-lahey
madx-dev-linux-nagfor:  madx-dev-linux32-nagfor madx-dev-linux64-nagfor

madx-dev-linux32:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=32 ONLINE=yes STATIC=yes Intel=yes APPENDLD=yes && \
     $(CP) madx32 $@

madx-dev-linux64:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=64 ONLINE=yes STATIC=yes Intel=yes APPENDLD=yes && \
     $(CP) madx64 $@

madx-dev-linux32-gnu:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=32 ONLINE=yes STATIC=yes GNU=yes APPENDLD=yes && \
     $(CP) madx32 $@

madx-dev-linux64-gnu:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=64 ONLINE=yes STATIC=yes GNU=yes APPENDLD=yes && \
     $(CP) madx64 $@

madx-dev-linux32-nagfor:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=32 ONLINE=yes STATIC=yes FC=nagfor APPENDLD=yes && \
     $(CP) madx32 $@

madx-dev-linux64-nagfor:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=64 ONLINE=yes STATIC=yes FC=nagfor APPENDLD=yes && \
     $(CP) madx64 $@

madx-dev-linux32-lahey:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=32 ONLINE=yes STATIC=yes FC=lf95 APPENDLD=yes && \
     $(CP) madx32 $@

madx-dev-linux64-lahey:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory -j5 ARCH=64 ONLINE=yes STATIC=yes FC=lf95 APPENDLD=yes && \
     $(CP) madx64 $@

# libptc
.PHONY:                 libptc-dev-linux        libptc-dev-linux-gnu
.PHONY:                 libptc-dev-linux32      libptc-dev-linux64
.PHONY:                 libptc-dev-linux32-gnu  libptc-dev-linux64-gnu
libptc-dev-linux:       libptc-dev-linux32      libptc-dev-linux64
libptc-dev-linux-gnu:   libptc-dev-linux32-gnu  libptc-dev-linux64-gnu

libptc-dev-linux32:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=32 Intel=yes APPENDLD=yes && \
     $(CP) libs/ptc/libptc32.a $@.a

libptc-dev-linux64:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=64 Intel=yes APPENDLD=yes && \
     $(CP) libs/ptc/libptc64.a $@.a

libptc-dev-linux32-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=32 GNU=yes APPENDLD=yes && \
     $(CP) libs/ptc/libptc32.a $@.a

libptc-dev-linux64-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C libs/ptc --no-print-directory -j5 ARCH=64 GNU=yes APPENDLD=yes && \
     $(CP) libs/ptc/libptc64.a $@.a

# numdiff
.PHONY:                 numdiff-dev-linux         numdiff-dev-linux-gnu
.PHONY:                 numdiff-dev-linux32       numdiff-dev-linux64
.PHONY:                 numdiff-dev-linux32-gnu   numdiff-dev-linux64-gnu
numdiff-dev-linux:      numdiff-dev-linux32       numdiff-dev-linux64
numdiff-dev-linux-gnu:  numdiff-dev-linux32-gnu   numdiff-dev-linux64-gnu

numdiff-dev-linux32:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=32 Intel=yes APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff32 $@ && ln -sf $@ numdiff32

numdiff-dev-linux64:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=64 Intel=yes APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff64 $@ && ln -sf $@ numdiff64

numdiff-dev-linux32-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=32 GNU=yes APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff32 $@ && ln -sf $@ numdiff32

numdiff-dev-linux64-gnu:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=64 GNU=yes APPENDLD=yes && \
     $(CP) tools/numdiff/numdiff64 $@ && ln -sf $@ numdiff64

# end of makefile
