# |
# o---------------------------------------------------------------------o
# |
# | MAD makefile - post-makefile Windows customization
# |
# o---------------------------------------------------------------------o
# |
# | Methodical Accelerator Design
# |
# | Copyright (c) 2011+ CERN, mad@cern.ch
# |
# | For more information, see http://cern.ch/mad
# |
# o---------------------------------------------------------------------o
# |
# | $Id$
# |

#
# all
#
.PHONY: all-win all-win32 all-win64

all-win:    madx-win    numdiff-win
all-win32:  madx-win32  numdiff-win32
all-win64:  madx-win64  numdiff-win64

#
# madx
#
.PHONY:     madx-win
.PHONY:     madx-win32  madx-win64
madx-win:   madx-win32  madx-win64

madx-win%: MAKE_OPTS = -j5
madx-win%: MAKE_ARGS = PRJNAME=$@ DESTDIR=$(DESTDIR) ONLINE=no STATIC=yes APPENDLD=yes
madx-win%: MAKE_POST = $(if $(DESTDIR),$(CP) $(DESTDIR)$@.exe $@.exe &&,) $(CP) $@.exe

madx-win32:
	$E "*** Building $@"
	$_ $(MAKE) $(MAKE_OPTS) $(MAKE_ARGS) ARCH=32 Intel=yes && $(MAKE_POST) madx32.exe

madx-win64:
	$E "*** Building $@"
	$_ $(MAKE) $(MAKE_OPTS) $(MAKE_ARGS) ARCH=64 Intel=yes && $(MAKE_POST) madx64.exe

#
# numdiff
#
.PHONY:       numdiff-win
.PHONY:       numdiff-win32  numdiff-win64
numdiff-win:  numdiff-win32  numdiff-win64

numdiff-win%: DESTDIR  := $(DESTDIR)tools$/numdiff
numdiff-win%: MAKE_OPTS = -j5 --no-print-directory -C tools/numdiff
numdiff-win%: MAKE_ARGS = PRJNAME=$@ DESTDIR=..$/..$/$(DESTDIR) APPENDLD=yes
numdiff-win%: MAKE_POST = $(if $(DESTDIR),$(CP) $(DESTDIR)$/$@.exe $@.exe &&,) $(CP) $@.exe

numdiff-win32:
	$E "*** Building $@"
	$_ $(MAKE) $(MAKE_OPTS) $(MAKE_ARGS) ARCH=32 Intel=yes && $(MAKE_POST) numdiff32.exe

numdiff-win64:
	$E "*** Building $@"
	$_ $(MAKE) $(MAKE_OPTS) $(MAKE_ARGS) ARCH=64 Intel=yes && $(MAKE_POST) numdiff64.exe

