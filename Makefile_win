# |
# o---------------------------------------------------------------------o
# |
# | MAD makefile - post-makefile Windows customization
# |
# o---------------------------------------------------------------------o
# |
# | Methodical Accelerator Design
# |
# | Copyright (c) 2011+ CERN, mad@cern.ch
# |
# | For more information, see http://cern.ch/mad
# |
# o---------------------------------------------------------------------o
# |
# | $Id$
# |

#
# all
#
.PHONY: all-win all-win32 all-win64

all-win:    madx-win       numdiff-win
all-win32:  madx-win32.exe numdiff-win32.exe
all-win64:  madx-win64.exe numdiff-win64.exe

#
# madx
#
.PHONY:     madx-win
.PHONY:     madx-win32.exe  madx-win64.exe
madx-win:   madx-win32.exe  madx-win64.exe

madx-win32.exe:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory ARCH=32 ONLINE=no STATIC=yes Intel=yes APPENDLD=yes && \
     $(CP) madx32.exe $@

madx-win64.exe:
	$E "*** Building $@"
	$_ $(MAKE) --no-print-directory ARCH=64 ONLINE=no STATIC=yes Intel=yes APPENDLD=yes && \
     $(CP) madx64.exe $@

#
# numdiff
#
.PHONY:       numdiff-win
.PHONY:       numdiff-win32.exe   numdiff-win64.exe
numdiff-win:  numdiff-win32.exe   numdiff-win64.exe

numdiff-win32.exe:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=32 Intel=yes APPENDLD=yes && \
     $(CP) tools$/numdiff$/numdiff32.exe $@ && $(CP) $@ numdiff32.exe

numdiff-win64.exe:
	$E "*** Building $@"
	$_ $(MAKE) -C tools/numdiff --no-print-directory -j5 ARCH=64 Intel=yes APPENDLD=yes && \
     $(CP) tools$/numdiff$/numdiff64.exe $@ && $(CP) $@ numdiff64.exe

