%%\title{the mad program}
%  Changed by: Chris ISELIN, 27-Jan-1997 
%  Changed by: Oliver Bruning, 20-Jun-2002 

\section{Matching Methods}
\label{sec:match_methods}

MADX currently supports four different matching algorithms: 

\subsection{\href{lmdif}{LMDIF: Fast Gradient Minimisation}} 	
\label{subsec:match_lmdif}
The LMDIF command minimises the sum of squares of the constraint
functions using their numerical derivatives:  
 
\begin{verbatim}
LMDIF,CALLS=integer,TOLERANCE=real;
\end{verbatim} 

It is the fastest minimisation method available in MAD. The command has
two attributes:  
\begin{itemize}
   \item CALLS: The maximum number of calls to the penalty function (default: 1000). 
   \item TOLERANCE: The desired tolerance for the minimum (default: 10**(-6)). 
\end{itemize}

Example: 
\begin{verbatim}
LMDIF,CALLS=2000,TOLERANCE=1.0E-8;
\end{verbatim}

\subsection{\href{migrad}{MIGRAD: Gradient Minimisation}}
\label{subsec:match_migrad}
The MIGRAD command minimises the penalty function using the numerical derivatives of the sum of squares: 

\begin{verbatim}
MIGRAD,CALLS=integer,TOLERANCE=real,STRATEGY=1;
\end{verbatim}
The command has three attributes: 

\begin{itemize}
   \item CALLS: The maximum number of calls to the penalty function (default: 1000). 
   \item TOLERANCE: The desired tolerance for the minimum (default: 10**(-6)). 
   \item STRATEGY: A code for the strategy to be used (default:
     1). Details are given in \href{bibliography.html#minuit}{[James]}.  
\end{itemize} 

Example: 
\begin{verbatim}
MIGRAD,CALLS=2000,TOLERANCE=1.0E-8;
\end{verbatim}

\subsection{\href{simplex}{SIMPLEX: Simplex Minimisation}}
\label{subsec:match_simplex}
The SIMPLEX command minimises the penalty function by the simplex method: 

\begin{verbatim}
SIMPLEX,CALLS=integer,TOLERANCE=real;
\end{verbatim}

Details are given in \href{bibliography.html#minuit}{[James]}. The command has two attributes: 
\begin{itemize}
   \item CALLS: The maximum number of calls to the penalty function (default: 1000). 
   \item TOLERANCE: The desired tolerance for the minimum (default: 10**(-6)). 
\end{itemize} 

Example: 
\begin{verbatim}
SIMPLEX,CALLS=2000,TOLERANCE=1.0E-8;
\end{verbatim}

\subsection{\href{jacobian}{JACOBIAN: Newton Minimisation}}
\label{subsec:match_jacobian}
The JACOBIAN command minimises the penalty function calculating the
Jacobian and solving the linear problem. A QR or LQ  decomposition is
performed when the system is over or under-determined. Before starting
the matching routine two optional transformations (COOL and RANDOM) are
performed.      

\begin{verbatim}
JACOBIAN, CALLS=integer, TOLERANCE=real, REPEAT=integer, 
          STRATEGY=integer, COOL=real, BALANCE=real, RANDOM=real;
\end{verbatim}

The command has the attributes: 
\begin{itemize}
   \item CALLS: The maximum number of calls to the penalty function (default: 30). 
   \item TOLERANCE: The desired tolerance for the minimum (default: 10**(-6)). 
   \item REPEAT: The number of call of the JACOBIAN routine (default: 1). 
   \item BISEC: Selects the maximum number of iteratation used to
     determin the step length which reduces the penalty function during
     the main iteration. A large number (i.e. 6) reduce the probability
     to diverge from the solution, but increase the one for being
     trapped in a local minum.  
   \item STRATEGY: A code for the strategy to be used (default: 3). If
     STRATEGY=1 the routine resets the values of the variables which
     exceeds the limits. If STRATEGY=2 the routine print the Jacobian
     and exit without matching. If STRATEGY=3 the routine  disables the
     variables which exceeds the limits keeping however the number of
     variables greater or equal to the number of the constraints.  
   \item COOL, BALANCE: The factors which specify the following transformation:
\begin{verbatim}
  if "balance" >=0
     newval=(1-cool)*oldval+cool*( (1-balance)*maxval+balance*minval )
  else
     newval=(1-cool)*oldval+cool* optval
\end{verbatim}
      where \texttt{newval} is the new value after the transformation,
      \texttt{oldval} is the previous value, \texttt{maxval, minval,
        optval} are the maximum value, minimum value, optimal value of
      the variable specified in the \href{match_vary.html}{VARY}
      command.  
    \item RANDOM: The factors which specify the following transformation:
\begin{verbatim}
   newval= (1+ random * rand() ) * oldval
\end{verbatim}
      where \texttt{newval} is the new value after the transformation,
      \texttt{oldval} is the previous value, \texttt{rand()} is a stochastic
      variable with a uniform (-0.5,0.5) distribution.   
\end{itemize} 

Example: 
\begin{verbatim}
JACOBIAN,CALLS=20,TOLERANCE=1.0E-8,STRATEGY=3,COOL=0.1,BALANCE=0.5,RANDOM=0.01;
\end{verbatim}

%\line(1,0){300}

%\href{http://bruening.home.cern.ch/bruening/}{Oliver Br\"uning}, June, 2002. 
%\href{http://rdemaria.home.cern.ch/rdemaria/}{Riccardo de Maria}, February, 2006. 
