%%\title{Variables in MAD}
%  Changed by: Chris ISELIN, 17-Jul-1997 
%  Changed by: Hans Grote, 10-Jun-2002 

\section{Variables}

\subparagraph{ For each variable the physical units are listed in square brackets. }

\subsection{\href{canon}{Canonical Variables Describing Orbits}} 
MAD uses the following canonical variables to describe the motion of particles: 
\begin{itemize}
   \item X: Horizontal position \textit{x} of the (closed) orbit,
     referred to the ideal orbit [m].    
   \item PX: Horizontal canonical momentum \textit{p$_x$} of the
     (closed) orbit referred to the ideal orbit, divided by the
     reference momentum: PX = \textit{p$_x$ / p$_0$}, [1].   
   \item Y: Vertical position \textit{y} of the (closed) orbit, referred
     to the ideal orbit [m].   
   \item PY: Vertical canonical momentum \textit{p$_y$} of the (closed)
     orbit referred to the ideal orbit, divided by the reference
     momentum: PY = \textit{p$_x$ / p$_0$}, [1].   
   \item T: Velocity of light times the negative time difference with
     respect to the reference particle: T = \textit{ - c t}, [m]. A
     positive T means that the particle arrives ahead of the reference
     particle.   
   \item PT: Energy error, divided by the reference momentum times the
     velocity of light: PT = delta(\textit{E}) / \textit{p$_s$ c},
     [1]. This value is only non-zero when synchrotron motion is
     present. It describes the deviation of the particle from the orbit
     of a particle with the momentum error DELTAP.   
   \item DELTAP: Difference of the reference momentum and the design
     momentum, divided by the reference momentum: DELTAP =
     delta(\textit{p}) / \textit{p$_0$}, [1]. This quantity is used to
     \href{defects.html}{normalize} all element strengths.   
\end{itemize} 

The independent variable is: 
\begin{itemize}
	\item \href{s}{S}: Arc length \textit{s} along the reference
          orbit, [m].   
\end{itemize} 

In the limit of fully relativistic particles (gamma $\gg$ 1, \textit{v
  = c}, \textit{p c = E}), the variables T, PT used here agree with the
longitudinal variables used in
\href{bibliography.html#transport}{[TRANSPORT]}. This means that T
becomes the negative path length difference, while PT becomes the
fractional momentum error. The reference momentum \textit{p$_s$} must be
constant in order to keep the system canonical.  

\subsection{\href{normal}{Normalised Variables and other Derived Quantities}}
\begin{itemize}
	\item XN: The normalised horizontal displacement\\
          XN = \textit{x$_n$} = Re(\textit{E$_1$$^T$ S Z}), [sqrt(m)]. 
	\item PXN: The normalised horizontal transverse momentum \\    
          PXN = \textit{x$_n$} = Im(\textit{E$_1$$^T$ S Z}), [sqrt(m)].     
	\item WX: The horizontal Courant-Snyder invariant \\
          WX = sqrt(\textit{x$_n$$^2$ + p$_{xn}$$^2$}), [m].    
	\item PHIX: The horizontal phase \\    
          PHIX = - atan(\textit{p$_{xn}$ / x$_n$}) / 2 pi [1].      
	\item YN: The normalised vertical displacement \\
          YN = \textit{x$_n$} = Re(\textit{E$_2$$^T$ S Z}), [sqrt(m)].     
	\item PYN: The normalised vertical transverse momentum \\ 
          PYN = \textit{x$_n$} = Im(\textit{E$_2$$^T$ S Z}), [sqrt(m)].     
	\item WY: The vertical Courant-Snyder invariant \\
          WY = sqrt(\textit{y$_n$$^2$ + p$_{yn}$$^2$}), [m].     
	\item PHIY: The vertical phase \\ 
          PHIY = - atan(\textit{p$_{yn}$ / y$_n$}) / 2 pi [1].     
	\item TN: The normalised longitudinal displacement \\     
          TN = \textit{x$_n$} = Re(\textit{E$_3$$^T$ S Z}), [sqrt(m)].     
	\item PTN: The normalised longitudinal transverse momentum \\    
          PTN = \textit{x$_n$} = Im(\textit{E$_3$$^T$ S Z}), [sqrt(m)].     
	\item WT: The longitudinal invariant \\    
          WT = sqrt(\textit{t$_n$$^2$ + p$_{tn}$$^2$}), [m].     
	\item PHIT: The longitudinal phase \\    
          PHIT = + atan(\textit{p$_{tn}$ / t$_n$}) / 2 pi [1].     
\end{itemize} 

In the above formulas \textit{Z} is the phase space vector
\textit{Z = ( x, p$_x$, y, p$_y$, t, p$_t$)$^T$}, the vectors
\textit{E$_i$} are the three complex eigenvectors and  
the matrix \textit{S} is the ``symplectic unit matrix'' 
%%\includegraphics{../equations/S_matrix.gif}
%S_matrix
\[
S =
 \begin{pmatrix}
  0 & 1 & 0 & 0 & 0 & 0 \\
  -1 & 0 & 0 & 0 & 0 & 0 \\
  0 & 0 & 0 & 1 & 0 & 0 \\
  0 & 0 & -1 & 0 & 0 & 0 \\
  0 & 0 & 0 & 0 & 0 & 1 \\
  0 & 0 & 0 & 0 & -1 & 0 \\
 \end{pmatrix}
\]


\subsection{\href{linear}{Linear Lattice Functions (Optical Functions)}} 

Several MAD commands refer to linear lattice functions. Since MAD uses
the canonical momenta (\textit{p$_x$}, \textit{p$_y$}) instead of the
slopes (\textit{x}', \textit{y}'), their definitions differ slightly
from those in \href{bibliography.html#courant}{[Courant and
    Snyder]}. Notice that in MAD-X PT substitutes DELTAP as longitudinal
variable. Dispersive and chromatic functions are hence derivatives with
respects to PT. Being PT=BETA*DELTAP, where BETA is the relativistic
Lorentz factor, those functions must be multiplied by BETA a number of
time equal to the order of the derivative. 

The linear lattice functions are known to MAD under the following names:
\begin{itemize}
	\item BETX: Amplitude function beta$_\textit{x}$, [m].   
	\item ALFX: Correlation function alpha$_\textit{x}$, [1]:\\     
          ALFX = alpha$_\textit{x}$ = - 1/2 * (del beta$_\textit{x}$ / del \textit{s}).     
	\item MUX: Phase function mu$_\textit{x}$, [2pi]:\\
          MUX = mu$_\textit{x}$ = integral (d\textit{s} / beta$_\textit{x}$).     
	\item DX: Dispersion \textit{D$_x$} of \textit{x}, [m]:\\
          DX = \textit{D$_x$} = (del \textit{x} / del PT).     
	\item DPX: Dispersion \textit{D$_px$} of \textit{p$_x$}, [1]:\\
          DPX = \textit{D$_px$} = (del \textit{p$_x$} / del PT) / \textit{p$_s$}.     
	\item BETY: Amplitude function beta$_\textit{y}$, [m].   
	\item ALFY: Correlation function alpha$_\textit{y}$, [1].\\
          ALFY = alpha$_\textit{y}$ = - 1/2 * (del beta$_\textit{y}$ / del \textit{s}).     
	\item MUY: Phase function mu$_\textit{y}$, [2pi].\\
          MUY = mu$_\textit{y}$ = integral (d\textit{s} / beta$_\textit{y}$).     
	\item DY: Dispersion \textit{D$_y$} of \textit{y}, [m]:\\
          DY = \textit{D$_y$} = (del \textit{y} / del PT).     
	\item DPY: Dispersion \textit{D$_px$} of \textit{p$_x$}, [1]:\\
          DPY = \textit{D$_py$} = (del \textit{p$_y$} / del PT) / \textit{p$_s$}.     
	\item R11, R12, R21, R22: Coupling Matrix     
	\item ENERGY: The total energy per particle in GeV. If given, it
          must be greater then the particle mass.
\end{itemize}

%  The TWISS table also defines the following expressions which 
%  can be used in plots:
% \begin{itemize}
%   \item  GAMX = (1 + ALFX*ALFX) / BETX, 
%   \item  GAMY = (1 + ALFY*ALFY) / BETY, 
%   \item  SIGX = SQRT(BETX * EX), the vertical r.m.s. half-width of the beam, 
%   \item  SIGY = SQRT(BETY * EY), the vertical r.m.s. half-height of the beam. 
% \end{itemize}


\subsection{\href{chrom}{Chromatic Functions}} 
Several MAD commands refer to the chromatic functions. 

Because MAD-X uses the (\textit{p$_x$}, \textit{p$_y$}) coordinates
instead of the slopes (\textit{x}', \textit{y}'), the definition of the
chromatic functions in MAD-X differ slightly from those in
\href{bibliography.html#montague}{[Montague]}.  

Notice also that in MAD-X, PT substitutes DELTAP as longitudinal
variable. Dispersive and chromatic functions are hence derivatives with
respects to PT. Since we have PT=BETA*DELTAP, where BETA is the
relativistic Lorentz factor, those functions must be multiplied by BETA
a number of time equal to the order of the derivative. The chromatic
functions are known to MAD under the following names:  

\textit{Please note that this option is needed for a proper calculation
  of the chromaticities in the presence of coupling!} 

\begin{itemize}
   \item WX: Chromatic amplitude function \textit{W$_x$}, [1]:\\
     WX = \textit{W$_x$} = sqrt(\textit{a$_x$$^2$ + b$_x$$^2$}),\\
     \textit{a$_x$} = (del beta$_\textit{x}$ / del PT) / beta$_\textit{x}$,\\
     \textit{b$_x$} = (del alpha$_\textit{x}$ / del PT) -
     (alpha$_\textit{x}$ / beta$_\textit{x}$) * (del beta$_\textit{x}$ /
     del PT).      
   \item PHIX: Chromatic phase function Phi$_\textit{x}$, [2pi]:\\
     PHIX = Phi$_\textit{x}$ = atan(\textit{a$_x$ / b$_x$}).     
   \item DMUX: Chromatic derivative of phase function mu$_\textit{x}$, [2pi]:\\
     DMUX = (del mu$_\textit{x}$ / del PT).     
   \item DDX: Chromatic derivative of dispersion \textit{D$_x$}, [m]:\\
     DDX = 1/2 * (del$^2$\textit{x} / del PT$^2$).     
   \item DDPX: Chromatic derivative of dispersion \textit{D$_px$}, [1]:\\
     DDPX = 1/2 * (del$^2$\textit{p$_x$} / del PT$^2$) / \textit{p$_s$}.     
   \item WY: Chromatic amplitude function \textit{W$_y$}, [1]:\\
     WY = \textit{W$_y$} = sqrt(\textit{a$_y$$^2$ + b$_y$$^2$}),\\     
     \textit{a$_y$} = (del beta$_\textit{y}$ / del PT) / beta$_\textit{y}$,\\     
     \textit{b$_y$} = (del alpha$_\textit{y}$ / del PT) -
     (alpha$_\textit{y}$ / beta$_\textit{y}$) * (del beta$_\textit{y}$ /
     del PT).     
   \item PHIY: Chromatic phase function Phi$_\textit{y}$, [2pi]:\\     
     PHIY = Phi$_\textit{y}$ = atan(\textit{a$_y$ / b$_y$}).     
   \item DMUY: Chromatic derivative of phase function mu$_\textit{y}$, [2pi]:\\     
     DMUY = (del mu$_\textit{y}$ / del PT).     
   \item DDY: Chromatic derivative of dispersion \textit{D$_y$}, [m]:\\     
     DDY = 1/2 * (del$^2$\textit{y} / del PT$^2$).     
   \item DDPY: Chromatic derivative of dispersion \textit{D$_py$}, [1]:\\ 
     DDPY = 1/2 * (del$^2$\textit{p$_y$} / del PT$^2$) / \textit{p$_s$}.     
\end{itemize}

\subsection{\href{summ}{Variables in the SUMM Table}} 
After a successful TWISS command a summary table is created which
contains the following variables:  
\begin{itemize}
   \item LENGTH: The length of the machine, [m].     
   \item ORBIT5: The T (= \textit{c t}, [m]) component of the closed orbit.     
   \item ALFA: The momentum compaction alpha$_p$, [1].     
   \item GAMMATR: The transition energy gamma$_transition$, [1].     
   \item Q1: The horizontal tune \textit{Q$_1$} [1].     
   \item DQ1: The horizontal chromaticity dq$_\textit{1}$, [1]:\\     
     DQ1 = dq$_\textit{1}$ = (del \textit{Q$_1$} / del PT).     
   \item BETXMAX: The largest horizontal beta$_\textit{x}$, [m].     
   \item DXMAX: The largest horizontal dispersion [m].     
   \item DXRMS: The r.m.s. of the horizontal dispersion [m].     
   \item XCOMAX: The maximum of the horizontal closed orbit deviation [m].     
   \item XRMS: The r.m.s. of the horizontal closed orbit deviation [m].     
   \item Q2: The vertical tune \textit{Q$_2$} [1].     
   \item DQ2: The vertical chromaticity dq$_\textit{2}$, [1]:\\     
     DQ2 = dq$_\textit{2}$ = (del \textit{Q$_2$} / del PT).     
   \item BETYMAX: The largest vertical beta$_\textit{y}$, [m].     
   \item DYMAX: The largest vertical dispersion [m].     
   \item DYRMS: The r.m.s. of the vertical dispersion [m].     
   \item YCOMAX: The maximum of the vertical closed orbit deviation [m].     
   \item YCORMS: The r.m.s. of the vertical closed orbit deviation [m].     
   \item DELTAP: Energy difference, divided by the reference
     momentum times the velocity of light, [1]:\\
     DELTAP = delta(\textit{E}) / \textit{p$_s$ c}.
\end{itemize} 

Notice that in MAD-X PT substitutes DELTAP as longitudinal
variable. Dispersive and chromatic functions are hence derivatives with
respects to PT. Being PT=BETA*DELTAP, where BETA is the relativistic
Lorentz factor, those functions must be multiplied by BETA a number of
time equal to the order of the derivative.  

\subsection{\href{track}{Variables in the TRACK Table}} 
The command RUN writes tables with the following variables: 
\begin{itemize}
   \item X: Horizontal position \textit{x} of the orbit, referred to the
     ideal orbit [m].    
   \item PX: Horizontal canonical momentum \textit{p$_x$} of the orbit
     referred to the ideal orbit, divided by the reference momentum.    
   \item Y: Vertical position \textit{y} of the orbit, referred to the
     ideal orbit [m].    
   \item PY: Vertical canonical momentum \textit{p$_x$} of the orbit
     referred to the ideal orbit, divided by the reference momentum.    
   \item T: Velocity of light times the negative time difference with
     respect to the reference particle, [m]. A positive T means that the
     particle arrives ahead of the reference part icle.   
   \item PT: Energy difference, divided by the reference momentum times
     the velocity of light, [1].    
\end{itemize} 

When tracking Lyapunov companions (not yet implemented), the TRACK table
defines the following dependent expressions:  
\begin{itemize}
   \item DISTANCE: the relative Lyapunov distance between the two
     particles.    
   \item LYAPUNOV: the estimated Lyapunov Exponent.   
   \item LOGDIST: the natural logarithm of the relative distance.   
   \item LOGTURNS: the natural logarithm of the turn number.   
\end{itemize}

%\href{http://www.cern.ch/Hans.Grote/hansg_sign.html}{hansg}, January 24, 1997. Revised in February 2007.

