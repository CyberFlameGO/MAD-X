%%\title{Known Defects of MAD8 and MAD-X}
%  Changed by: Chris ISELIN, 24-Jan-1997 
%  Changed by: Hans Grote, 25-Sep-2002 

\chapter{Known Differences to Other Programs}

\section{Definitions} 

MAD uses full 6-by-6 matrices to allow coupling effects to be treated,
and the canonical variable set (\textit{x}, \textit{p$_x$ / p$_0$}),
(\textit{y}, \textit{p$_y$ / p$_0$}), (\textit{-ct}, delta(\textit{E}) /
\textit{p$_0$ c}), as opposed to other programs most of which use the
set (\textit{x}, \textit{x}'), (\textit{y}, \textit{y}'),
(-delta(\textit{s}), delta(\textit{p})/\textit{p$_0$}). Like
\href{bibliography.html#dragt}{[Dragt]}, MAD uses the relative energy
error \textit{p$_y$ / p$_0$}, which is equal the relative momentum error
delta = delta(\textit{p})/\textit{p$_0$} multiplied by beta = v/c.  
\\ \\ 
As from Version 8.13, MAD8 uses an additional \textbf{constant} momentum
error delta$_\textit{s}$ in all optical calculations. The transfer maps
contain the \textbf{exact} dependence upon this value; therefore the
tunes for large deviations can be computed with high accuracy as opposed
to previous versions.  

 
The choice of canonical variables in MAD still leads to slightly
different definitions of the lattice functions. In MAD the
Courant-Snyder invariants in \href{bibliography.html#courant}{[Courant
    and Snyder]} take the form  

W$_x$ = gamma$_\textit{x}$\textit{x}$^2$ - 2 alpha$_\textit{x}$\textit{x
  p$_x$} + beta$_\textit{x}$\textit{p$_x$}$^2$ 

Comparison to the original form 

 W$_x$ = gamma$_\textit{x}$\textit{x}$^2$ - 2
 alpha$_\textit{x}$\textit{x x}' + beta$_\textit{x}$\textit{x}'$^2$ 

shows that the orbit functions cannot be the same. A more detailed analysis, using 

\textit{x}' = \textit{p$_x$} / (1 + delta) 

shows that all formulas can be made consistent by defining the MAD orbit
functions as  
 
beta$_\textit{x}M$ = beta$_\textit{x}C$ * (1 + delta),
alpha$_\textit{x}M$ = alpha$_\textit{x}C$, gammaa$_\textit{x}M$ =
gamma$_\textit{x}C$ / (1 + delta),  

For constant delta$_\textit{s}$ along the beam line and delta = 0, the
lattice functions are the same. In a machine where delta varies along
the circumference, e.g. in a linear accelerator or in an
electron-positron storage ring, the definition of the Courant-Snyder
invariants must be generalised. The MAD invariants have the advantage
that they remain invariants along the beam line even for variable delta.  

With the new method this problem occurs in
\href{../twiss/twiss.html}{Twiss module} only for non-constant delta.   

\section{Treatment of Energy Error in TWISS} 
It has been noted in \href{bibliography.html#ruggiero}{[Milutinovic and
    Ruggiero]} that MAD returned tunes which are too low for non-zero
delta. The difference was found to be quadratic in delta with a negative
coefficient. This problem has been eliminated thanks to the new
treatment  of momentum errors from MAD8 Version 8.13 onwards.   

%\href{http://www.cern.ch/Hans.Grote/hansg_sign.html}{hansg}, January 24, 1997 

