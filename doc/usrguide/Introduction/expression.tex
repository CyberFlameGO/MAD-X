%%\title{Expressions}
%  Changed by: Chris ISELIN, 27-Mar-1997 

%  Changed by: Hans Grote, 25-Sep-2002 

%%\usepackage{hyperref}
% commands generated by html2latex


%%\begin{document}
%%\begin{center}
 %%EUROPEAN ORGANIZATION FOR NUCLEAR RESEARCH 
%%\includegraphics{http://cern.ch/madx/icons/mx7_25.gif}

\subsection{\href{expression}{ Real Expressions}}
%%\end{center} 

  To facilitate the definition of interdependent quantities, any real value and integer value can be entered as an arithmetic expression. When a value used in an expression is redefined by the user or changed in a matching process, the expression is reevaluated. Expression definitions may be entered in any order. MAD evaluates them in the correct order before it performs any computation. At evaluation time all operands used must have values assigned. 

 An expression is built from a combination of \hyperlink{operator}{operator} and \hyperlink{operand}{operand}, and it may contain \hyperlink{random}{random generators}.  

\subsection{\href{operator}{ Operators in Arithmetic Expressions}} An expression can be formed using the following operators: 

\subsubsection{Arithmetic operators}
\begin{itemize}
	\item + Addition, 
	\item - Subtraction, 
	\item * Multiplication, 
	\item / Division, 
	\item \textasciicircum Exponentiation. 
\end{itemize}

\subsubsection{\href{function}{Ordinary functions}}
\begin{itemize}
	\item sqrt(x) square root, 
	\item log(x) natural logarithm, 
	\item log10(x) logarithm base 10, 
	\item exp(x) exponential, 
	\item sin(x) trigonometric sine, 
	\item cos(x) trigonometric cosine, 
	\item tan(x) trigonometric tangent, 
	\item asin(x) arc sine, 
	\item acos(x) arc cosine, 
	\item atan(x) arc tangent, 
	\item sinh(x) hyperbolic sine, 
	\item cosh(x) hyperbolic cosine, 
	\item tanh(x) hyperbolic tangent, 
	\item abs(x) absolute value; 
\end{itemize}

\subsubsection{\href{random}{random number generators}}
\begin{itemize}
	\item ranf() random number, uniformly distributed in [0,1], 
	\item gauss() random number, gaussian distribution with unit standard deviation, 
	\item tgauss(x) random number, gaussian distribution with unit standard deviation, truncated at x standard deviations; 
\end{itemize} in the above cases, "x" can be any expression, i.e. contain other functions, variable or constant expressions. To initialize the MAD-X random generator use the \href{../error/error_option.html#EOPTION}{Eoption command}. 

\subsubsection{\href{table}{table access functions}}
\begin{itemize}
	\item table(x,z): accesses value of the named table column "z" of table "x"; example: table(summ,q1) returns the hor. tune of the Twiss summary table "summ". 
	\item table(x,y,z): accesses value of the named table column "z" for element "y" (first table row with that name) of table "x"; example: table(twiss,mb.12,betx) returns the beta\_x at element mb.12 from the Twiss table "twiss".   When the element is called with its proper name, as in the example above, the value is returned at the first occurrence of the element of this name. If the value is needed at a occurrence number: NNN, then "[NNN]" has to be appended to the name, e.g. in the above example one obtains the betx of the 23th occurrence of the element "mb.12" by changing the example to: "table(twiss,mb.12[23],betx)". Mind you that the old, but little known, form: "table(twiss,mb.12-\textgreater 23,betx)" continues to work. Lastly, if NNN exceeds the maximum occurrence number the return value is arbitrarily small. 

Beware: 
	\item  Unnamed Drifts are not included in the table name database, so as to speed up the search for "real" elements. Therefore, those  unnamed drifts cannot be found. However, named drifts can be searched for. 
	\item  Due to the importance of finding elements in the table for a proper functioning of the MAD-X runs, the programs throws a "fatal\_error" if an element cannot be found in the table.  

 There is a second option of this function with 3 entries  
	\item table(x,z,N\_row): accesses the value of the named table column  "z" at the "N\_row" number of rows of table "x" (row numbers start at  1); example: table(twiss,betx,370) returns the beta\_x at row number  "370" of the Twiss table "twiss". The return value is zero if "N\_row"  is outside of the allowed range.  

 Note that "N\_row" has to be a number and not a  variable. However, the \href{../control/special.html#macro}{Macro facility} in MAD-X  allows one to use a variable instead. 

 A typical example could look like this, in fact the square root of betx (user defined variable myvar) is added to the twiss table: 


\begin{verbatim}

myvar := sqrt(table(twiss,betx));
select,flag=twiss,column=name,s,myvar,betx;
twiss,file;
\end{verbatim}

 Or another arbitrary test case of adding k1l taken from the Twiss table: 

 Define macro: 


\begin{verbatim}

mycrap(xx,yy,zz): macro = {myval = table(xx,yy,zz);};
\end{verbatim}

 Use macro in loop: 


\begin{verbatim}
i = 0;
incval = 0;
while (i < 100) {
value,i;
exec,mycrap(twiss,k1l,$i);
incval = incval + myval;
value,i,myval,incval;                
i = i + 1;
}
\end{verbatim}

\subsubsection{Features as of Version 3\_03\_50}
	\item 

 FILL,TABLE=t,ROW=n; 

 fill a table row with the present variable values. If ROW is negative or missing a new row is created. If ROW is greater than the number of rows, the last row is selected without creating a new row. 


	\item    SETVARS,TABLE=t,ROW=n; 

 set variables according to the column names of the given table and the values of the given row. if ROW is negative, missing or greater than the number of rows, the last row is selected. 


	\item  An example can be found at: \href{http://cern.ch/frs/mad-X_examples/special_features}{Special Features}


	\item  The length of a table can be determined by using the attribute "tablelength" via table("your\_table\_name", tablelength). This is useful when creating a table from existing ones. See an example at: \href{../Introduction/select.html#screate}{user table II}


\end{itemize}

\subsection{\href{operand}{ Operands in Arithmetic Expressions}} An expression may contain the following operands:  

\subsubsection{Literal constants} Numerical values are entered like FORTRAN constants. Real values are accepted in INTEGER or REAL format. The use of a decimal exponent, marked by the letter D or E, is permitted. 

 Examples: 
\begin{verbatim}

1, 10.35, 5E3, 314.1592E-2
\end{verbatim}

\subsubsection{\href{constant}{Symbolic constants}} MAD recognizes some \hyperlink{constant}{mathematical and physical constants}. Their names must not be used for user-defined labels. 

 Additional symbolic constants may be defined to simplify their repeated use in statements and expressions. 
\begin{verbatim}
CONST name=constant-expression;\end{verbatim} defines a real constant with the name given. An existing symbolic constant can be redefined, but it cannot change in a matching procedure. 

 Example: 
\begin{verbatim}

const in = 0.0254;
\end{verbatim}

%http://en.wikibooks.org/wiki/LaTeX/Tables#Text_wrapping_in_tables
%\href{constant}{
\begin{table}
\begin{center}
{\textbf{Table 1:} Predefined Symbolic Constants in MAD}
\begin{tabular}{l|l|l|l}
% if you want to use \caption the tabular must be enclosed in
% table or figure environment
\textbf{mad name} & \textbf{symbol} & \textbf{value used} & \textbf{unit} \\ 
pi & pi & 4 * atan(1) & 1 \\ 
twopi & 2 pi & 2 * pi & 1 \\ 
degrad & 180/pi & 180 / pi & deg/rad \\ 
raddeg & pi/180 & 180 / pi & rad/deg \\ 
e & e & exp(1) & 1 \\ 
emass & m\_e & .510998902*10(-3) & GeV \\ 
pmass & m\_p & .938271998 & GeV \\ 
mumass & m\_mu & .1056583568 & GeV \\ 
clight & c & 2.99792458*10**8 & m/s \\ 
qelect & elem. charge & 1.602176462e-19 & As
\end{tabular}
\end{center}
\end{table}

\subsubsection{Parameter labels} Often a set of numerical values depends on a common variable parameter. Such a parameter must be defined as a \href{parameter.html}{global parameter}. A global parameter always has a current value; however, this value may be re-evaluated or not, depending on the parameter definition: 
\begin{verbatim}

x = a;
\end{verbatim} x is set to the current value of a and not changed, even if a changes. This makes assignments such as 
\begin{verbatim}

x = x + 1;
\end{verbatim} perfectly valid (this replaces the old SET instruction). The definition of the deferred expression 
\begin{verbatim}

x := a;
\end{verbatim} assign the current value of a to x every time x is used, i.e. it is re-evaluated using the latest value of a; therefore, 
\begin{verbatim}

x := x + 1;
\end{verbatim} results in an infinite loop (!) when x is used (error abort). Of course, the following definitions are equivalent: 
\begin{verbatim}

x = 0.1;
x := 0.1;
\end{verbatim}

 When such a parameter is used in an expression, MAD uses the current value of the parameter if the expression is deferred: 

 Example: 
\begin{verbatim}

x:=1.0;
d1: drift,l = x;
d2: drift,l := 2.0 - x;
\end{verbatim} When the value of X is changed, the length of the drift d1 remains unchanged, that of d2 is recalculated.  

\subsubsection{Element or command attributes} In arithmetic expressions the attributes of physical elements or commands can occur as operands. They are named respectively by 
\begin{verbatim}

element-name->attribute-name
command-name->attribute-name
\end{verbatim} Values are assigned to attributes in element definitions or commands. 

 Example: 
\begin{verbatim}

D1: DRIFT,L=1.0;
D2: DRIFT,L=2.0-D1->L;
\end{verbatim} D1-\textgreater L refers to the length L of the drift space D1.  

\subsection{\href{defer}{Expressions and Random Values}} The definition of random machine imperfections requires evaluation of expressions containing random functions. These are evaluated like any other expression when the expression is used, i.e. only once if a "=" assignment refers to it, or every time if the assignment is ":="; this latter case is used by the error generation routines. 

 Example: 
\begin{verbatim}

a := 3*ranf();
\end{verbatim} Every time a is used, it gets a random value assigned from a uniform distribution between 0 and 3. 
\begin{verbatim}

error:  ealign,range,dx:=sigma*gauss();
\end{verbatim} All elements in range are assigned independent random displacements sampled from a Gaussian distribution with standard deviation sigma. 

\href{http://www.cern.ch/Hans.Grote/hansg_sign.html}{hansg}, May 8, 2001 

%%\end{document}
