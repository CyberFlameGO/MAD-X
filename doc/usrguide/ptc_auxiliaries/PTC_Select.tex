%%\title{PTC\_SELECT}

\section{PTC\_SELECT}

\begin{verbatim}
PTC_SELECT, 
   table      = [s, none, none], 
   column     = [s, none, none], 
   polynomial = [i, none] , 
   monomial   = [s, none] , 
   parametric = [l, false, true], 
   quantity   = [s, none] ; "
\end{verbatim}


Selects map elements to be: 
\begin{enumerate}
  \item {\bf Stored in a user specified table and column.}
    \textit{Table} and \textit{column} must be specified then, and such
    table with such column must exists.  

  \item {\bf Stored as a function (taylor series) of
    \href{PTC_Knob.html}{knobs}, if any is defined.} Then,
    \textit{parametric} should be set to true. 
\end{enumerate}
Both cases can be joined in one command.   


{\bf Command parameters and switches}

\begin{itemize}
   \item {\bf table}=string (Default: ???)\\
     Specifies name of the table where values should be stored.   
   \item {\bf column}=string (Default: ???)\\     
     Specifies name of the table where values should be stored.   
   \item {\bf polynomial}=integer (Default: ???)\\
     Specifies row of the map.   
   \item {\bf monomial}=string composed of digits (Default: ???)\\
     Defines monomial of the polynomial in PTC nomenclature. \\
     Its length should be equal to number of variables. Each digit
     corresponds to the exponent of a variable. Monomial 'ijklmn'
     defines x$^i$p$_x$$^j$y$^k$p$_y$$^l$
     $\Delta$T$^m$($\Delta$p/p)$^n$. For example, element=2 and
     monomial=1000000 defines coefficient of the second polynomial (that
     defines p$_x$) close to x, in the other words it is R21.  
   \item{\bf parametric}=logical (Default: .false.)\\
     If true, and any \href{PTC_Knob.html}{knobs} are defined, the
     map element is stored as the parametric result.            
\end{itemize}


{\bf Examples}\\

\href{http://cern.ch/frs/mad-X_examples/ptc_madx_interface/ptc_secordmatch/chicane.madx}{dog
  leg chicane}: strength of quads is matched to obtain required T112
value.    

\href{http://cern.ch/frs/mad-X_examples/ptc_madx_interface/eplacement/chicane.madx}{dog
  leg chicane}: postion of quads is matched to obtain required T566
value.   

\href{http://cern.ch/frs/mad-X_examples/ptc_madx_interface/matchwithknobs/matchwithknobs.madx}{dog
  leg chicane}: dipole and quadrupole strengths are matched with the
help of knobs to obtain required momentum compaction and Twiss
functions.   


{\bf PROGRAMMER'S MANUAL} 

The command is implemented pro\_ptc\_select function in madxn.c and  by
subroutine addpush in madx\_ptc\_knobs.f90, that is part of
madx\_ptc\_knobs\_module   

On the very beginning the existance of the table and within column is
checked. In the case of failure, error message is printed and the
function is abandoned.   

The command parameters are passed as the arguments of addpush Fortran
routine.  A selection is stored in a type called tablepush\_poly defined
madx\_ptc\_knobs.inc. A newly created object is added to array named
pushes.    

More then one element might be stored in a single table, so the module
must assure that  each of tables is augmented only ones for each magnet
(or integration slice).  For that purpose array of tables to be
augmented (named tables) is stored separately and  we assure that a
table is listed here only ones. This is simply done by checking  if a
table name is not already listed before adding a new element to the
array.   

In case the user requested an element to be stored in the paramteric
format, and column in the array of parametric results is reserved and
the index of the column is remembered in index field of tablepush\_poly
type is filled. In the other case this field is equal to zero.   

The routine ptc\_twiss (defined in file madx\_ptc\_twiss.f90), after
tracking each of magnets  in the sequence, calls putusertable
routine. This routine loops over selected elemetns defined in the pushes
table. For each of them it extracts the requested element from the map
using .sub.  operator of PTC and stores it in the defined table and
column.  If index field is not zero and any knob is defined, it extracts
the polynomial using .par. operator, and stores it in the 2D array
called results, in the row corresponding to the number of the magnet (or
integration step) and column defined by the index field.     

