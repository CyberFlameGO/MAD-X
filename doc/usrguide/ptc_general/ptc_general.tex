%\documentclass[a4paper,11pt]{article}
%%\usepackage{ulem}
%%\usepackage{a4wide}
%%\usepackage[dvipsnames,svgnames]{xcolor}
%%\usepackage[pdftex]{graphicx}
%%\title{PTC Set-up Parameters}
%  Created by: Valery KAPIN, 21-Mar-2006 

%  Changed by: ____________, ___________ 

%  
% div.Section1 
%       {page:Section1;} 
% span.SpellE 
%       {} 
% 

%%\usepackage{hyperref}
% commands generated by html2latex


%%\begin{document}
%%\begin{center}
    %%EUROPEAN ORGANIZATION FOR NUCLEAR RESEARCH    
%%\includegraphics{http://cern.ch/madx/icons/mx7_25.gif}

\section{PTC Set-up Parameters}
%%\end{center}

  The E. Forest s Polymorphic Tracking Code (\hyperlink{E.Forest}{PTC})   is a kick code, allowing a symplectic integration through all   accelerator elements giving the user full control over the precision (number of   steps and integration type) and exactness (full or extended Hamiltonian) of the   results. The degree of exactness is determined by the user and the speed of his   computer. The\nolinebreak main advantage is that the code is inherently based on the   map formalism and provides users with all associated tools.

  The PTC code is actually a library that can be used in many different ways to   create an actual module that calculates some property of interest. Several   modules using the PTC code have been presently implemented in MAD-X. These MADX-PTC modules [\hyperlink{F.Schmidt}{b}] are   executed by the following   commands: \href{../ptc_twiss/ptc_twiss.html}{  ptc\_twiss}, \href{../ptc_normal/ptc_normal.html}{  ptc\_normal}, \href{../ptc_track/ptc_track.html}{  ptc\_track},  \href{../ptc_track_line/ptc_track_line.html}{  ptc\_track\_line}. To perform calculations with these MADX-PTC commands, the PTC   environment must be initialized, handled and turned off by the special commands within the MAD-X   input script.

\line(1,0){300}

\begin{description}
	\item[Synopsis] 
	\textbf{\\}

\texttt{PTC\_CREATE\_UNIVERSE, sector\_nmul\_max=integer, \\
sector\_nmul=integer, ntpsa=logical, symprint=logical;}\\
\texttt{PTC\_CREATE\_LAYOUT, time=logical, model=integer,\\
method=integer, nst=integer, exact=logical, \\
offset\_deltap=double, errors\_out=logical, \\
magnet\_name=string, resplit=logical, thin=double, xbend=double,      \\ even=logical;}\\
\texttt{.........................}\\
\textit{\texttt{PTC\_READ\_ERRORS, overwrite=logical;}}\\
\texttt{.........................}\\
\textit{\texttt{PTC\_MOVE\_TO\_LAYOUT, index=integer;}}\\
\texttt{.........................}\\
\textit{\texttt{PTC\_ALIGN;}}\\
\texttt{.........................}\\
\textit{\texttt{ PTC\_END;}}\\
\end{description}
\begin{description}
	\item[Commands] 
	\item \texttt{\textbf{\textbf{PTC\_CREATE\_UNIVERSE}}}\textbf{\textbf{;}}
	 
\texttt{\textbf{sector\_nmul\_max}=integer, \textbf{sector\_nmul}=integer}
	\item[Description] 
%  <strong>TRACK, DELTAP= double, ONEPASS, DUMP, ONETABLE, FILE= string;</strong> (MADX version 1)<br /> 
%     <strong>TRACK, DELTAP= double, ONEPASS, DAMP, QUANTUM, DUMP, ONETABLE, FILE= string;</strong> (MADX version 2)<br /> 
The \texttt{"PTC\_CREATE\_UNIVERSE" }command is needed to set-up  the PTC environment.

	\item[Options] 
	\text{ \\}	% this is just for a new line.
	
%\resizebox{15cm}{!} {
\begin{tabular}{l p{6cm} p{1.5cm} p{1.5cm}}
\hline 
\textbf{Option} & \textbf{Meaning} & \textbf{Default Value} & \textbf{Value Type} \\ 
\hline
SECTOR\_NMUL\_MAX & Global variable in PTC needed for       exact sector bends defining up to which order Maxwell's       equation are solved [\hyperlink{E.Forest}{a}, page       76-77]. The value of SECTOR\_NMUL\_MAX must not be       smaller than SECTOR\_NMUL otherwise MAD-X stops with an       error. & 10 & integer \\ 
\hline
SECTOR\_NMUL & Global variable in PTC needed for exact sector bends defining up to which order the multipole are included in solving Maxwell's equation up to order SECTOR\_NMUL\_MAX. Multipoles of order N with N $>$ SECTOR\_NMUL and N $\leq$ SECTOR\_NMUL\_MAX are treated a la SixTrack. & 10 & integer \\ 
\hline
NTPSA & This attribute invokes the second DA package written in C++ and kindly provided by Lingyun Yang  lyyang@lbl.gov. Etienne Forest has written the wrapper to allow  both the use of the legendary DA packages written in Fortran by  Martin Berz (default) or this new DA package. It is expected that this DA package will allow for the efficient calculation of a large number of DA parameters. & .FALSE. & logical \\ 
\hline
SYMPRINT & This flag allows the supression of the printing of the check of symplecticity. It is recommended to leave this flag set to TRUE. & .TRUE. & logical \\ 
\hline
\end{tabular}
%}

  \item \textbf{\href{PTC_CREATE_LAYOUT}{PTC\_CREATE\_LAYOUT}}, \textbf{ time}=logical,\textbf{ model}=integer,       \textbf{method}=integer,
  
\textbf{ nst}=integer, \textbf{exact=logical},       \textbf{offset\_deltap}=double, \textbf{errors\_out}=logical,       \textbf{magnet\_name}=string, 

\textbf{resplit}=logical, \textbf{thin}=double,       \textbf{xbend}=double, \textbf{even}=logical;
	
\end{description}
\begin{description}
	\item[Description] 
%  <strong>TRACK, DELTAP= double, ONEPASS, DUMP, ONETABLE, FILE= string;</strong> (MADX version 1)<br /> 
%     <strong>TRACK, DELTAP= double, ONEPASS, DAMP, QUANTUM, DUMP, ONETABLE, FILE= string;</strong> (MADX version 2)<br /> 
The \texttt{"PTC\_CREATE\_LAYOUT" }command creates the PTC-layout according to  the specified integration method and fills it with the current  MAD-X sequence defined in the latest \href{../control/general.html#use}{ USE} command.
\\ The logical input variable time  controls the coordinate system that is being used.
	\item[Options] 
	\text{ \\} % new line
	
%http://stackoverflow.com/questions/2896833/how-to-stretch-a-table-over-multiple-pages
%http://nepsweb.co.uk/docs/tableTricks.pdf
\begin{longtable}{l p{8cm} p{2cm} p{2cm}}
%\begin{tabular}{l p{8cm} ll}
\hline 
\textbf{Option} & \textbf{Meaning} &  \textbf{Default Value} & \textbf{Value Type} \\ 
\hline
TIME
& 
\begin{tabular}{p{0.2cm} p{7.0cm}}
\multirow{2}{*}{5D} & 
"time=true": fifth coordinate is \href{../Introduction/tables.html#canon}{PT}, \textit{p$_t$}=$\Delta$\textit{E}/\textit{p}$_0$\textit{c;} \\
& "time=false": fifth coordinate is \href{../Introduction/tables.html#canon}{DELTAP}, \textit{$\delta$}$_\textit{p}$=$\Delta$\textit{p}/\textit{p}$_0$ \\
\hline
\multirow{2}{*}{6D} & 
"time=true": \href{../Introduction/tables.html#canon}{   MAD-X coordinate system} \{-\textit{ct}, \textit{p$_t$}\} \\
& "time=false": second PTC coordinate system \{-pathlength, \textit{$\delta$}$_\textit{p}$\} \\

\end{tabular}
 & 
.TRUE. & 
logical\\

\hline
MODEL &  Type of element: 1, 2,or 3. & 1 & integer \\ 
\hline
METHOD & Integration order (2, 4, 6) [\hyperlink{E.Forest}{a}, Chapter K] & 2 & integer \\ 
\hline
NST & Number of integration steps: 1, 2, 3,  . & 1 & integer \\ 
\hline
EXACT & Switch to turn on calculations with an exact Hamiltonian, otherwise the expanded Hamiltonian is used. & .FALSE. & logical \\ 
\hline
OFFSET\_DELTAP & Beware: Expert flag! The relative momentum deviation of the reference particle (6D case ONLY). This option implies "totalpath=true". & 0.0 & double \\ 
\hline
ERRORS\_OUT & Flag to write-out multipolar errors in Efcomp table format. Two     tables are filled "errors\_field"     and "errors\_total". In the first     case only field errors are written out and in the second one also     desired field components are added. The latter is useful e.g. to     include the strength of correctors. The choice of magnets is     defined by the "magnet\_name"     attribute (see below). As usual the tables can be     written to files for later use for read-in via the "ERRORS\_IN" flag:\newline
\newline
write, table=errors\_field,file=Your\_Errors\_Field\_File;\newline
write, table=errors\_total,file=Your\_Errors\_Total\_File;\newline
\newline
The "ERRORS\_IN" flag has precedence over     this "ERRORS\_OUT" flag.   & 
.FALSE. & logical \\
\hline
MAGNET\_NAME & 
  Simple selection for the names of magnet to be used for an error write-out   using the "ERRORS\_OUT" flag (see above).   In fact, the errors are recorded for all magnets with their name starting with  the exact string of "MAGNET\_NAME".   & 
NULL & string \\
\hline
RESPLIT & 
  Flag to apply the PTC resplit procedure. This is meant to        create an "adaptive" setting of the "METHOD" and  "NST"  attributes according to the        strength of the quadrupoles (using the "THIN"  attribute) and separatedly the        dipoles (using the "XBEND"  attribute). Additionally, there        is the  "EVEN" attribute for even and odd number        of splits. & 

.FALSE. & logical \\
\hline
 THIN & 
   This is the main "RESPLIT" attribute. It is meant        for splitting quadrupoles according to their strength. The default        of "THIN=0.001" has shown in practice to        work well without costing too much with respect of performance.  & 
0.001 & double \\
\hline
XBEND & 
   This attribute is meant for splitting dipoles, e.g. "XBEND=0.001". It is an optional "RESPLIT" attribute and therefore has the        default set to -1, which means no splitting. A splitting by "XBEND=0.001" maybe advisable for dipoles        as well.  & 
-1 (off) & double \\
\hline
 EVEN & 
  Switch to ensure even number of splits when using the PTC "RESPLIT" procedure. The default is "EVEN=TRUE". This is particularly useful        when one attempts to calculate "PTC\_TWISS" with then "CENTER\_MAGNETS" option, i.e. if one        would like to calculate the TWISS parameters in the center of        the element. Uneven number of splits will be achieved with "EVEN=FALSE". & 
.TRUE. & logical \\
\hline
%\end{tabular}
\end{longtable}
 
	\item[Remarks] 
	\text{ \\}
		
    \textbf{TIME:} at small energy ($\beta$$_0$  $<$$<$1), momentum-dependent variables like dispersion will depend  strongly on the choice of  the logical input variable "time".  In fact, the derivative ($\partial$/$\partial$\textit{$\delta$}$_\textit{p}$)  and ($\partial$/$\partial$\textit{p}$_\textit{t}$)  are different by the factor \textit{$\beta$}$_0$. One would  therefore typically  choose the option "time=false",  which\nolinebreak sets the fifth variable to the relative momentum deviation \textit{$ \delta_p$ }.\\ 
    
	\textbf{MODEL}:\nolinebreak\nolinebreak  1 for "Drift-Kick-Drift"; 2 for "Matrix-Kick-Matrix"; 3 for  "Delta-Matrix-Kick-Matrix" (SixTrack-code model).\\
	
	\textbf{NST}: sets the same value  for all "thick" elements (\textit{l }$>$ 0) of a beam-line.  Please note, that each individual element may have its own NST  value (\hyperlink{individual}{see below}).\\

\end{description}
\begin{description}
	\item {\textbf{PTC\_READ\_ERRORS}, \\ \textbf{overwrite}=logical;} 
	
	\item[Description] The \texttt{"PTC\_READ-ERRORS" }command let's you read any numbers of  \textbf{"errors\_read"} tables  \href{../control/general.html#readmytable}{READMYTABLE}
	\item[Options] 
	\text{ \\}	% this is just for a new line.
	
\begin{tabular}{l p{6cm} p{1.5cm} p{1.5cm}}
\hline 
\textbf{Option} & \textbf{Meaning} & \textbf{Default Value} & \textbf{Value Type} \\ 
\hline
OVERWRITE & 
Flag to either OVERWRITE the read-in errors (on request by using this flag) or by DEFAULT just add them to multipole components already present.   & .FALSE. & logical \\ 
\hline
\end{tabular}

	\item[Remarks] 
    
    \item {\textbf{PTC\_MOVE\_TO\_LAYOUT}, \\ \textbf{index}=integer;}
\end{description}

\begin{description}
	\item[Description]  Several PTC layouts can be created within a one PTC-"universe".  The layouts are automatically numbered with sequential integers  by the MAD-X code. The \texttt{"PTC\_MOVE\_TO\_LAYOUT" }is used for an activation\nolinebreak of a requested  layout and the next PTC commands will be applied to this active  PTC layout until a new PTC layout will be created or activated.
	\item[Option] 
	\text{ \\}	% this is just for a new line.	
	
\begin{tabular}{l p{6cm} p{1.5cm} p{1.5cm}}
\hline 
\textbf{Option} & \textbf{Meaning} & \textbf{Default Value} & \textbf{Value Type} \\ 
\hline
INDEX & Number of the PTC layout to be activated. & 1 & integer \\ 
\hline
\end{tabular}

\end{description}

\begin{description}
	\item[\textbf{PTC\_ALIGN;}] 
	\item[Description] 
%  <strong>TRACK, DELTAP= double, ONEPASS, DUMP, ONETABLE, FILE= string;</strong> (MADX version 1)<br /> 
%  <strong>TRACK, DELTAP= double, ONEPASS, DAMP, QUANTUM, DUMP, ONETABLE, FILE= string;</strong> (MADX version 2)<br /> 
The \texttt{"PTC\_ALIGN" }command is used to apply the MAD-X alignment  errors to the current PTC layout.
\end{description}

\begin{description}
	\item[\textbf{PTC\_END;}] 
	\item[Description] 
%  <strong>TRACK, DELTAP= double, ONEPASS, DUMP, ONETABLE, FILE= string;</strong> (MADX version 1)<br /> 
%  <strong>TRACK, DELTAP= double, ONEPASS, DAMP, QUANTUM, DUMP, ONETABLE, FILE= string;</strong> (MADX version 2)<br /> 
The \texttt{"PTC\_END" }command  is turning off the PTC environment,  which releases all memory back to the MAD-X world proper;
\end{description}

\begin{description}
	\item[Additional Options for Physical Elements] 

	\item {\textbf{[SBEND | RBEND | \href{PTC_CREATE_LAYOUT0}{ QUADRUPOLE | \\ SEXTUPOLE | OCTUPOLE | SOLENOID ], }\\
 l}=double\textbf{, .....,tilt}=double\textbf{, ...., nst}=integer, ...,\\
 \textbf{knl}:=\{0, double, double,..\}, \textbf{ksl}:=\{0, double, double,..\};}

	\item[Description] 
	\text{ \\} % for anew line

	1. The full range of  normal and skew multipole components on the bench can be  specified for the following physical elements: \texttt{sbend, rbend, quadrupole, sextupole,  octupole and solenoid. }Multipole coefficients are specified as the integrated value "$\int$\textit{Kds"}  of the field components along the magnet axis (see \hyperlink{Multipoles_on_Bench_(PTC_only)}{the table} below). These multipole components in PTC are spread over a whole   element, if \textit{l }$>$ 0. This is a considerable advantage of PTC input compare  to MAD-X  which allows only \href{../Introduction/multipole.html}{ thin multipoles}.
\\ 2. To preserve the reference orbit of straight elements, dipole components  for those elements are   ignored, knl(0)=0, ksl(0)=0.
\\ 3. \href{individual}{Individual}\hyperlink{NST}{NST} values for a  particular "thick" element (\textit{l }$>$ 0) can be specified. For example,  in MAD-X any RF cavity is represented by a single kick, while  PTC splits the RF cavity into (global) NST segments. In this  way, PTC considers properly transit-time effects of the cavity.  In case, one wants to reproduce the approximate results of  MAD-X, one can use NST=1 for RF cavity in PTC.
	\item[Multipoles on Bench  (PTC only)] 
	\text{  \\}	%new line
	
\begin{tabular}{cccc}
\hline 
\textbf{Option} & \textbf{Meaning} & \textbf{Default Value} & \textbf{Value Type} \\ 
\hline
KNL & The normal multipole coefficient & 0 [m$^{-1}$]  & double array \\ 
\hline
KSL & The skew multipole coefficient & 0 [m$^{-1}$]  & double array \\ 
\hline
\end{tabular}

	\item[Remarks]
	\text{  \\}	%new line
		
	 \textbf{Length l: }Bending magnets (\texttt{sbend,  rbend}) are treated as "markers", if \textit{l} = 0.
\\
\\ Additional Field Errors: A full range of multipole \href{../error/error_field.html}{ field errors} can be additionally specified with \href{../error/error_field.html#efcomp}{ EFCOMP} command. Errors are added to the above multipole  fields on the bench.


	\item[Caution] A user has to understand that PTC exists inside of MAD-X as a          library. MAD-X offers the interface to PTC, i.e. the MAD-X input file is          used as input for PTC. Internally, both PTC and MAD-X have their own          independent databases which are linked via the interface.With the \texttt{\hyperlink{PTC_CREATE_LAYOUT}{"PTC\_CREATE\_LAYOUT"}}         command, only numerical numbers are          transferred from the MAD-X          database to the PTC database. Any modification to the MAD-X          database is ignored in PTC until the next call to \texttt{\hyperlink{PTC_CREATE_LAYOUT}{"PTC\_CREATE\_LAYOUT"}}.For example, a         \href{../Introduction/expression.html#defer}{         deferred expression} of MAD-X after a         \texttt{\hyperlink{PTC_CREATE_LAYOUT}{"PTC\_CREATE\_LAYOUT"}}         command is ignored within PTC. 
	\item[Examples] Examples for any MADX-PTC module contain the above PTC set-up          commands. 

	\item[References] 
\end{description}
\begin{enumerate}
	\item \href{E.Forest}{E.Forest}, F.Schmidt and E.McIntosh,  Introduction to the Polymorphic Tracking Code ,          \href{http://cern.ch/madx/doc/sl-2002-044.pdf}{CERN-SL-2002-044},         \href{http://ccdb4fs.kek.jp/cgi-bin/img/allpdf?200302020}{KEK report          2002-3}, July 2002.
	\item \href{F.Schmidt}{F. Schmidt}, "`\href{http://cern.ch/madx/doc/MPPE012.pdf}{MAD-X PTC Integration}'',          Proc. of the 2005 PAC Conference in Knoxville, USA, pp.1272.
\end{enumerate}
\begin{description}
	\item[See Also] 
	\text{ \\}	%new line
	
	\href{../ptc_twiss/ptc_twiss.html}{ptc\_twiss}, \href{../ptc_normal/ptc_normal.html}{ptc\_normal}, \href{../ptc_track/ptc_track.html}{ ptc\_track},         \href{../ptc_track_line/ptc_track_line.html}{ptc\_track\_line}.
\end{description}

\line(1,0){300}

\href{mailto:kapin@itep.ru}{  V.Kapin}(ITEP) and \href{mailto:Frank.Schmidt@cern.ch}{  F.Schmidt}, March  2006

%%\end{document}
