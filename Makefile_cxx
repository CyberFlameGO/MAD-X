# |
# o---------------------------------------------------------------------o
# |
# | MAD makefile - C++ files selection
# |
# o---------------------------------------------------------------------o
# |
# | Methodical Accelerator Design
# |
# | Copyright (c) 2011+ CERN, mad@cern.ch
# |
# | For more information, see http://cern.ch/mad
# |
# o---------------------------------------------------------------------o
# |
# | $Id$
# |

vpath %.hpp src
vpath %.cpp src

CXX_DIR := src
CXX_HDR := $(notdir $(wildcard src/mad_*.hpp)) 
CXX_SRC := $(notdir $(wildcard src/mad_*.cpp))

ifeq ($(NTPSA),yes)
  CXX_HDR += tpsa.h 
  CXX_SRC += tpsa.cpp
endif

#######################
# C++ dependencies (case not automatic!)

ifeq ($(CXXDEP),)

tpsa.o:         tpsa.h
mad_mkthin.o:   madx.h

endif

#######################
# check for g++ version >= 4.4
#

ifneq ($(filter $(BUILDGOALS),$(MAKECMDGOALS)),)
ifeq ($(CXX),g++)
CCVER  := $(strip $(shell $(CXX) -dumpversion))
CCVERL := $(subst ., ,$(CCVER))
CCVER1 := $(findstring $(word 1,$(CCVERL)),"456789")
CCVER2 := 0
  ifeq ($(CCVER1),4)
  CCVER2 := $(findstring $(word 2,$(CCVERL)),"456789")
  endif
ifeq ($(and $(CCVER1),$(CCVER2)),)
$(error MAD-X requires g++ >= 4.4 ($(if $(CCVER),$(CCVER),none) detected))
endif # version
endif # g++
endif # cmdgoal

# end of makefile
