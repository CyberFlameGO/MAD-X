# |
# o---------------------------------------------------------------------o
# |
# | MAD makefile - Tests
# |
# o---------------------------------------------------------------------o
# |
# | Methodical Accelerator Design
# |
# | Copyright (c) 2011+ CERN, mad@cern.ch
# |
# | For more information, see http://cern.ch/mad
# |
# o---------------------------------------------------------------------o
# |
# | $Id$
# |

#################################################
# testsuite

# variables:
# tests-all  : contains all tests        (includes tests-long)
# tests-long : contains all long tests   (overlaps tests-all)

# rules (commands):
# tests      : runs tests-all not in tests-long
# tests-all  : runs tests-all

# tests order
tests-all := \
test-rfmultipole test-rfmultipole-2 test-rfmultipole-3 test-rfmultipole-4 \
\
test-makethin \
test-track test-track-2 test-track-3 test-track-4 test-track-5 test-track-6 test-track-7 \
test-twiss test-twiss-2 test-twiss-3 test-twiss-4 \
test-jacobian test-jacobian-2 test-jacobian-knobs \
test-match test-match-2 \
test-aperture \
\
test-ptc-twiss \
test-ptc-normal \
test-ptc-trackline

# tests dependencies
test-track-2: test-makethin
test-track-7: test-makethin

# lexicographical order
tests-long := \
test-makethin \
test-match-2 \
test-ptc-twiss \
test-track-2 \
test-track-7 \
test-twiss\
test-twiss-2\
test-twiss-3\
test-twiss-4

# lexicographical order
tests-to-setup := \
test-ibs \
test-ptc-twiss-2

# testsuite titles (attached to first test of the suite)
test-aperture:     TESTSUITE := Aperture testsuite
test-ibs:          TESTSUITE := IBS testsuite
test-jacobian:     TESTSUITE := Jacobian testsuite
test-makethin:     TESTSUITE := Makethin testsuite
test-match:        TESTSUITE := Matching testsuite
test-ptc-twiss:    TESTSUITE := PTC Twiss testsuite
test-ptc-normal:   TESTSUITE := PTC Normal testsuite
test-rfmultipole:  TESTSUITE := RF multipole testsuite
test-track:        TESTSUITE := Track testsuite
test-twiss:        TESTSUITE := Twiss testsuite

# end of testsuite
#################################################

# madx supported command for tests
ifndef MADX
MADXCMD := $(firstword $(wildcard \
             $(PROJECT)_dev$(ARCH)$(BINARY_EXT) $(PROJECT)_dev$(BINARY_EXT) \
             $(PROJECT)-dev$(ARCH)$(BINARY_EXT) $(PROJECT)-dev$(BINARY_EXT) \
             $(PROJECT)$(ARCH)$(BINARY_EXT)     $(PROJECT)$(BINARY_EXT) ))
MADX    := $(if $(MADXCMD),..$/..$/$(MADXCMD),$(PROJECT)_dev$(ARCH)$(BINARY_EXT))
endif

TESTCMD = $(MADX) < $(@F).madx

# end of makefile
