# |
# o---------------------------------------------------------------------o
# |
# | MAD makefile - Tests
# |
# o---------------------------------------------------------------------o
# |
# | Methodical Accelerator Design
# |
# | Copyright (c) 2011+ CERN, mad@cern.ch
# |
# | For more information, see http://cern.ch/mad
# |
# o---------------------------------------------------------------------o
# |
# | $Id$
# |

#################################################
# testsuite

# variables:
# tests-all  : contains all tests        (includes tests-long)
# tests-long : contains all long tests   (overlaps tests-all)

# rules (commands):
# tests      : runs tests-all not in tests-long
# tests-all  : runs tests-all

# tests order
tests-all := \
test-setvars_lin \
test-memory \
\
test-makethin test-makethin-2 \
test-survey test-survey-2 \
test-track test-track-2 test-track-3 test-track-4 test-track-5 test-track-6 \
test-track-7 test-track-8 test-track-9 test-track-10 test-track-11 \
test-twiss test-twiss-2 test-twiss-3 test-twiss-4 test-twiss-5 test-twiss-6 test-twiss-7 test-twiss-8 \
test-cororbit test-cororbit-2 test-cororbit-3 \
test-emit test-emit-2 \
test-ibs test-ibs-2 test-ibs-3 test-ibs-4 \
test-error test-error-2 \
test-dynap \
test-c6t test-c6t-2 \
test-thick-quad test-thick-quad-2 test-thick-quad-3 \
test-jacobian test-jacobian-2 test-jacobian-knobs \
test-match test-match-2 test-match-3 test-match-4 \
test-match-5 test-match-6 test-match-7 test-match-8 \
test-aperture \
test-beam \
\
test-rfmultipole test-rfmultipole-2 test-rfmultipole-3 test-rfmultipole-4 \
\
test-ptc-twiss test-ptc-twiss-2 \
test-ptc-twiss-old1 test-ptc-twiss-old2 test-ptc-twiss-old3 test-ptc-twiss-old4 test-ptc-twiss-old5 $(if $(call eq,$(OSTYPE),Windows),,test-ptc-twiss-old6) test-ptc-twiss-old7 \
test-ptc-twiss-5D test-ptc-twiss-56D test-ptc-twiss-56Dt test-ptc-twiss-56Dl test-ptc-twiss-56Dtl \
test-ptc-normal \
test-ptc-trackline test-ptc-trackline-2 \
test-touschek test-touschek-2 \
test-sequence test-sequence-2 test-sequence-3

# same order as tests-all, tests that take +10s
# to know the timing: make tests-all TIMER=time (on Unixes)
tests-long := \
test-memory \
test-track-7 test-track-8 test-track-10 test-track-11 \
test-dynap \
test-match-6 test-match-7 \
test-ptc-twiss-2 \
$(if $(call eq,$(OSTYPE),Windows),,test-ptc-twiss-old6) test-ptc-twiss-old7 \
test-touschek test-touschek-2

# tests dependencies
test-c6t:     test-makethin-2
test-track-2: test-makethin-2
test-track-7: test-makethin-2
test-track-8: test-makethin-2

# lexicographical order
tests-to-setup := \
test-error-3__needs_generated_error_file_from_Riccardo

# testsuite titles (attached to first test of the suite, lex. order)
test-aperture:       TESTSUITE := Aperture testsuite
test-beam:           TESTSUITE := Beam testsuite
test-c6t:            TESTSUITE := SixTrack Conversion testsuite
test-cororbit:       TESTSUITE := Orbit Correction testsuite
test-dynap:          TESTSUITE := Dynamic Aperture testsuite
test-emit:           TESTSUITE := Emit testsuite
test-error:          TESTSUITE := Error testsuite
test-ibs:            TESTSUITE := IBS testsuite
test-jacobian:       TESTSUITE := Jacobian testsuite
test-makethin:       TESTSUITE := Makethin testsuite
test-match:          TESTSUITE := Matching testsuite
test-memory:         TESTSUITE := Memory Management testsuite
test-plot:           TESTSUITE := Plot Package testsuite
test-ptc-normal:     TESTSUITE := PTC Normal testsuite
test-ptc-trackline:  TESTSUITE := PTC Trackline testsuite
test-ptc-twiss:      TESTSUITE := PTC Twiss testsuite
test-rfmultipole:    TESTSUITE := RF Multipole testsuite
test-sequence:	     TESTSUITE := Sequence testsuite
test-setvars_lin:    TESTSUITE := Special features
test-survey:         TESTSUITE := Survey testsuite
test-thick-quad:     TESTSUITE := Thick Quadrupole testsuite
test-touschek:       TESTSUITE := Touschek testsuite
test-track:          TESTSUITE := Track testsuite
test-twiss:          TESTSUITE := Twiss testsuite

# end of testsuite
#################################################

# madx supported command for tests
ifndef MADX
MADXCMD := $(firstword $(wildcard $(PROJECT)$(ARCH)$(BINARY_EXT) $(PROJECT)$(BINARY_EXT)))
MADX    := $(if $(MADXCMD),..$/..$/$(MADXCMD),$(PROJECT)_dev$(ARCH)$(BINARY_EXT))
endif

TESTCMD = $(TIMER) $(MADX) $(@F).madx

# end of makefile
